{% extends "base.html" %}
{% block content %}

<div class="gallery">
    <!-- Локальные файлы -->
    {% for file in files %}
        {% if file.lower().endswith(('png','jpg','jpeg','gif')) %}
            <img src="{{ url_for('static', filename='uploads/' + file) }}" class="thumb" onclick="openFullscreen(this)">
        {% elif file.lower().endswith(('mp4','mov','avi','mkv','wmv','flv','webm')) %}
            <video class="thumb" onclick="openFullscreen(this)" controls>
                <source src="{{ url_for('static', filename='uploads/' + file) }}" type="video/mp4">
            </video>
        {% endif %}
    {% endfor %}

    <!-- Внешние ссылки -->
    {% for link in youtube_links %}
        {% if 'youtube.com' in link or 'youtu.be' in link %}
            {% set video_id = '' %}
            {% if 'watch?v=' in link %}
                {% set video_id = link.split('watch?v=')[1].split('&')[0] %}
            {% elif 'youtu.be' in link %}
                {% set video_id = link.split('/')[-1].split('?')[0] %}
            {% endif %}
            <div class="youtube-video">
                <iframe width="300" height="170"
                        src="https://www.youtube.com/embed/{{ video_id }}"
                        frameborder="0"
                        allowfullscreen>
                </iframe>
            </div>
        {% elif 'instagram.com' in link %}
            <blockquote class="instagram-media" data-instgrm-permalink="{{ link }}" data-instgrm-version="14" style="max-width:540px; width:100%; margin:10px auto;">
                <a href="{{ link }}" target="_blank">Instagram video</a>
            </blockquote>
        {% endif %}
    {% endfor %}
</div>

<!-- Скрипт Instagram embed -->
<script async src="//www.instagram.com/embed.js"></script>

<!-- Функция увеличения фото/видео -->
<script>
function openFullscreen(el) {
    const modal = document.createElement('div');
    modal.classList.add('fullscreen-modal');
    if(el.tagName === "IMG") {
        modal.innerHTML = `<img src="${el.src}" onclick="this.parentElement.remove()">`;
    } else if(el.tagName === "VIDEO") {
        modal.innerHTML = `<video src="${el.querySelector('source').src}" controls autoplay onclick="this.parentElement.remove()"></video>`;
    }
    document.body.appendChild(modal);
}
</script>

{% endblock %}
