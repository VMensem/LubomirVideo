{% extends "base.html" %}
{% block content %}
<div class="gallery">
    <!-- Локальные изображения и видео -->
    {% for file in files %}
        {% if file.lower().endswith(('png','jpg','jpeg','gif')) %}
            <img src="{{ url_for('static', filename='uploads/' + file) }}" class="thumb" onclick="openFullscreen(this)">
        {% elif file.lower().endswith(('mp4','mov','avi','mkv','wmv','flv','webm')) %}
            <video class="thumb" onclick="openFullscreen(this)" controls>
                <source src="{{ url_for('static', filename='uploads/' + file) }}">
            </video>
        {% endif %}
    {% endfor %}

    <!-- Внешние видео (YouTube, Instagram, Facebook, облака) -->
    {% for link in youtube_links %}
        {% if 'youtube.com' in link or 'youtu.be' in link %}
            <div class="youtube-video">
                <iframe width="300" height="170" src="{{ link | replace('watch?v=', 'embed/') }}" frameborder="0" allowfullscreen></iframe>
            </div>
        {% elif 'instagram.com' in link %}
            <blockquote class="instagram-media" data-instgrm-permalink="{{ link }}" data-instgrm-version="14" style="max-width:540px; width:100%; margin:10px auto;">
                <a href="{{ link }}" target="_blank">Instagram video</a>
            </blockquote>
        {% elif 'facebook.com' in link %}
            <iframe src="https://www.facebook.com/plugins/video.php?href={{ link | urlencode }}&show_text=0&width=300" width="300" height="170" style="border:none;overflow:hidden;" scrolling="no" frameborder="0" allowfullscreen></iframe>
        {% else %}
            <!-- Прямые ссылки на облачные видео (Google Drive, Dropbox и др.) -->
            <video class="thumb" controls>
                <source src="{{ link }}">
            </video>
        {% endif %}
    {% endfor %}
</div>

<!-- Скрипт для Instagram -->
<script async src="//www.instagram.com/embed.js"></script>

<script>
// Функция fullscreen для изображений и видео
function openFullscreen(el) {
    const modal = document.createElement('div');
    modal.classList.add('fullscreen-modal');
    modal.style.position = 'fixed';
    modal.style.top = 0;
    modal.style.left = 0;
    modal.style.width = '100%';
    modal.style.height = '100%';
    modal.style.background = 'rgba(0,0,0,0.9)';
    modal.style.display = 'flex';
    modal.style.alignItems = 'center';
    modal.style.justifyContent = 'center';
    modal.style.zIndex = 9999;

    if(el.tagName === "IMG") {
        const img = document.createElement('img');
        img.src = el.src;
        img.style.maxWidth = '90%';
        img.style.maxHeight = '90%';
        img.onclick = () => modal.remove();
        modal.appendChild(img);
    } else if(el.tagName === "VIDEO") {
        const video = document.createElement('video');
        video.src = el.querySelector('source').src;
        video.controls = true;
        video.autoplay = true;
        video.style.maxWidth = '90%';
        video.style.maxHeight = '90%';
        video.onclick = () => modal.remove();
        modal.appendChild(video);
    }
    document.body.appendChild(modal);
}
</script>

{% endblock %}
