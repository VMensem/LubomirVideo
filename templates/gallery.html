{% extends "base.html" %}
{% block content %}

<h2 style="text-align:center;">Галерея фото та відео</h2>

<div class="gallery">
    {% for file in files %}
        {% if file.lower().endswith(('png','jpg','jpeg','gif','bmp','webp','tiff','svg')) %}
            <div class="gallery-item">
                <img src="{{ url_for('static', filename='uploads/' + file) }}" class="thumb">
                {% if is_admin %}
                    <form method="post" action="{{ url_for('delete_file', filename=file) }}" onsubmit="return confirm('Видалити цей файл?');">
                        <button type="submit" class="btn-purple">Видалити</button>
                    </form>
                {% endif %}
            </div>
        {% elif file.lower().endswith(('mp4','mov','avi','mkv','wmv','flv','webm')) %}
            <div class="gallery-item">
                <video class="thumb" controls>
                    <source src="{{ url_for('static', filename='uploads/' + file) }}" type="video/mp4">
                </video>
                {% if is_admin %}
                    <form method="post" action="{{ url_for('delete_file', filename=file) }}" onsubmit="return confirm('Видалити цей файл?');">
                        <button type="submit" class="btn-purple">Видалити</button>
                    </form>
                {% endif %}
            </div>
        {% endif %}
    {% endfor %}

    {% for link in youtube_links %}
        <div class="gallery-item">
            <iframe width="300" height="170" src="{{ link | replace('watch?v=', 'embed/') }}" frameborder="0" allowfullscreen></iframe>
            {% if is_admin %}
                <button class="btn-purple" onclick="deleteLink('{{ link }}')">Видалити відео</button>
            {% endif %}
        </div>
    {% endfor %}
</div>

<script>
function deleteLink(link) {
    if(confirm("Видалити це відео?")) {
        fetch("{{ url_for('delete_link') }}", {
            method: "POST",
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ link: link })
        }).then(() => location.reload());
    }
}
</script>

<style>
.gallery {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 15px;
    padding: 20px;
}
.gallery-item {
    display: flex;
    flex-direction: column;
    align-items: center;
}
.gallery-item img.thumb,
.gallery-item video.thumb {
    width: 100%;
    height: 150px;
    object-fit: cover;
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.5);
    margin-bottom: 5px;
}
.gallery-item button.btn-purple {
    width: 100%;
    font-size: 0.85em;
    padding: 6px;
}
</style>

{% endblock %}
